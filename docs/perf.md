# tgState 性能测试报告

## 测试环境

| 项目 | 配置 |
|------|------|
| 测试日期 | YYYY-MM-DD HH:MM:SS |
| 操作系统 | [填写系统信息] |
| Python 版本 | [填写 Python 版本] |
| CPU | [填写 CPU 信息] |
| 内存 | [填写内存信息] |
| 网络环境 | [填写网络环境] |
| 服务 URL | http://127.0.0.1:8000 |

## 测试配置

| 参数 | 值 |
|------|-----|
| 并发用户数 | [填写并发数] |
| 总请求数 | [填写请求数] |
| 测试时长 | [填写时长] |
| 压测工具 | hey / locust |
| 数据规模 | [填写文件数量/总大小] |

## 测试命令

```bash
# 使用 hey 进行压测
cd scripts
chmod +x benchmark.sh
./benchmark.sh

# 使用 Locust 进行压测
locust -f scripts/locustfile.py --host http://127.0.0.1:8000
```

## 测试结果

### 1. 文件列表接口 (GET /api/files)

| 指标 | 值 |
|------|-----|
| 总请求数 | [填写] |
| 成功请求数 | [填写] |
| 失败请求数 | [填写] |
| QPS (Requests/sec) | [填写] |
| 平均延迟 (Average) | [填写] ms |
| 中位数延迟 (Median) | [填写] ms |
| P95 延迟 | [填写] ms |
| P99 延迟 | [填写] ms |
| 最小延迟 | [填写] ms |
| 最大延迟 | [填写] ms |

**延迟分布**:
```
[填写延迟分布数据]
```

**状态码分布**:
```
[填写状态码分布]
```

---

### 2. 文件上传接口 (POST /api/upload)

| 指标 | 值 |
|------|-----|
| 测试文件大小 | [填写] MB |
| 上传成功次数 | [填写] |
| 上传失败次数 | [填写] |
| 平均上传时间 | [填写] ms |
| 最小上传时间 | [填写] ms |
| 最大上传时间 | [填写] ms |

**说明**:
- 由于 hey 不支持文件上传，此测试使用 curl 进行单次上传测试
- 实际生产环境建议使用 Locust 进行文件上传压测

---

### 3. 文件下载接口 (GET /d/{file_id}/{filename})

| 指标 | 值 |
|------|-----|
| 总请求数 | [填写] |
| 成功请求数 | [填写] |
| 失败请求数 | [填写] |
| QPS (Requests/sec) | [填写] |
| 平均延迟 (Average) | [填写] ms |
| 中位数延迟 (Median) | [填写] ms |
| P95 延迟 | [填写] ms |
| P99 延迟 | [填写] ms |
| 最小延迟 | [填写] ms |
| 最大延迟 | [填写] ms |

**延迟分布**:
```
[填写延迟分布数据]
```

**状态码分布**:
```
[填写状态码分布]
```

---

### 4. 系统资源监控

| 指标 | 值 |
|------|-----|
| CPU 使用率 (峰值) | [填写] % |
| CPU 使用率 (平均) | [填写] % |
| 内存使用量 (峰值) | [填写] MB |
| 内存使用量 (平均) | [填写] MB |
| 网络带宽 (上传) | [填写] MB/s |
| 网络带宽 (下载) | [填写] MB/s |

---

## 性能瓶颈分析

基于测试结果，识别以下性能瓶颈：

1. **[瓶颈 1]**
   - 描述: [填写]
   - 影响: [填写]
   - 优先级: [高/中/低]

2. **[瓶颈 2]**
   - 描述: [填写]
   - 影响: [填写]
   - 优先级: [高/中/低]

3. **[瓶颈 3]**
   - 描述: [填写]
   - 影响: [填写]
   - 优先级: [高/中/低]

---

## 优化建议

根据性能瓶颈分析，提出以下优化建议：

### 高优先级

1. **[优化项 1]**
   - 描述: [填写]
   - 预期效果: [填写]
   - 实施难度: [低/中/高]

2. **[优化项 2]**
   - 描述: [填写]
   - 预期效果: [填写]
   - 实施难度: [低/中/高]

### 中优先级

1. **[优化项 3]**
   - 描述: [填写]
   - 预期效果: [填写]
   - 实施难度: [低/中/高]

### 低优先级

1. **[优化项 4]**
   - 描述: [填写]
   - 预期效果: [填写]
   - 实施难度: [低/中/高]

---

## 对比基线

| 指标 | 基线 | 优化后 | 改进幅度 |
|------|-------|--------|----------|
| QPS | [填写] | [填写] | [填写] % |
| P95 延迟 | [填写] ms | [填写] ms | [填写] % |
| P99 延迟 | [填写] ms | [填写] ms | [填写] % |
| CPU 使用率 | [填写] % | [填写] % | [填写] % |
| 内存使用量 | [填写] MB | [填写] MB | [填写] % |

---

## 结论

### 是否需要 Go 重写

**结论**: [需要 / 不需要]

### 理由

1. [理由 1]
2. [理由 2]
3. [理由 3]

### 最小可行 Go 化方案 (如需要)

**方案概述**: [填写方案概述]

**架构设计**:
```
[填写架构设计]
```

**迁移步骤**:
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

---

## 附录

### 详细日志

- 文件列表测试: `benchmark-results/list_YYYYMMDD_HHMMSS.log`
- 文件下载测试: `benchmark-results/download_YYYYMMDD_HHMMSS.log`
- 完整摘要: `benchmark-results/summary_YYYYMMDD_HHMMSS.txt`

### 注意事项

1. 测试前确保服务已启动
2. 测试期间请勿进行其他操作
3. 测试结果仅供参考，实际性能可能因环境而异
4. 建议多次测试取平均值
5. 确保 Telegram Bot 配置正确
6. 确保 CHANNEL_NAME 配置正确
